
---

- name: "configuration play."
  hosts: web
  user: ubuntu
  gather_facts: false
  vars:
    - ansible_python_interpreter: /usr/bin/python3
    - ansible_host_key_checking: false
    - ansible_stdout_callback: yaml
  tasks:

    - name: Git Checkout
      git:
        repo: https://github.com/Fontaineconsult/UCDOEND_Project3.git
        dest: ~/

    - name: CD Into Backend
      command: cd backend

    - name: Take a Look
      command: ls

    - name: Start Migration
      command: npm run migrations > output.txt

    - name: Test
      command: ls .circleci/ansible/roles/deploy-backend/files

    - debug: Test1
      msg: cat .circleci/ansible/roles/deploy-backend/files/wid.txt

    - debug: Test2
      msg: echo https://api.memstash.io/values/$(< .circleci/ansible/roles/deploy-backend/files/wid.txt)

    - name: Save ouput to memstash if success
      shell: |
        if grep -q \"has been executed successfully\" output.txt; then curl -H \"Content-Type\{{ ":" }} text/plain\" -H \"token: 7cb66ce8-9b24-4bbd-9b69-31b5ca339fc1\" --request PUT --data 0 https://api.memstash.io/values/$(< .circleci/ansible/roles/deploy-backend/files/wid.txt); fi

    - name: Save ouput to memstash if fail
      shell: |
        if ! grep -q \"has been executed successfully\" output.txt; then curl -H \"Content-Type\{{ ":" }} text/plain\" -H \"token: 7cb66ce8-9b24-4bbd-9b69-31b5ca339fc1\" --request PUT --data 1 https://api.memstash.io/values/$(< .circleci/ansible/roles/deploy-backend/files/wid.txt); fi




